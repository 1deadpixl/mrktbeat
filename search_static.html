    <html>
<head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery.tokeninput.js"></script>
    <link rel="stylesheet" href="css/token-input.css" type="text/css" />
    <link rel="stylesheet" href="css/token-input-mrktbeat.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="css/mrktbeat.css" />

    <style>
        @font-face {
          font-family: 'theFont';
          src: url('css/font.woff') format('woff');
        }

        #mrktbeat_search {
            top: 250px;
            position: relative;
            z-index: 50;
        }
        #mrktbeat_search * {
            z-index: 50;
        }

        svg {
            position: absolute;
            top: 0;
            left: 0;
            z-index: -50;
        }
        h1 {
            font-family: 'theFont', 'Avenir Next', 'Avenir Next Ultra Light', 'Helvetica Neue', sans-serif;
            font-weight: 'light';
            text-align: center;
            font-size: 70px;
            margin: 0;
            color: #906abd;
        }
        form {
            width: 500px;
            height: 150px;
            margin: 20px auto 0 auto;
            text-align: center;
        }


    </style>
</head>

<body>
    <div id="mrktbeat_search">
    <h1>MrktBeat</h1>
        <!-- <form action="data/markets.php" method="POST"> -->
            <input type="text" id="demo-input" name="q" size="100"/>
            <input type="submit" value="Submit" style="display:none;" />
        </form>
    </div>


    <script type="text/javascript">
        var data = '[{"id":"1","name":"Finance","normalized_amount":"1","time_since_last":"2"},{"id":"2","name":"Internet","normalized_amount":"0.7451","time_since_last":"2"},{"id":"3","name":"Health and Wellness","normalized_amount":"0.6054","time_since_last":"1"},{"id":"4","name":"Communities","normalized_amount":"0.3492","time_since_last":"4"},{"id":"5","name":"Oil and Gas","normalized_amount":"0.3489","time_since_last":"4"},{"id":"6","name":"Technology","normalized_amount":"0.2794","time_since_last":"2"},{"id":"7","name":"Transportation","normalized_amount":"0.2794","time_since_last":"2"},{"id":"8","name":"Content Creators","normalized_amount":"0.2328","time_since_last":"3"},{"id":"9","name":"E-Commerce","normalized_amount":"0.2328","time_since_last":"1"},{"id":"10","name":"Online Shopping","normalized_amount":"0.2328","time_since_last":"3"},{"id":"11","name":"Wireless","normalized_amount":"0.2328","time_since_last":"3"},{"id":"12","name":"Advertising","normalized_amount":"0.2212","time_since_last":"2"},{"id":"13","name":"Analytics","normalized_amount":"0.2095","time_since_last":"2"},{"id":"14","name":"Education","normalized_amount":"0.1746","time_since_last":"2"},{"id":"15","name":"Food Processing","normalized_amount":"0.1746","time_since_last":"2"},{"id":"16","name":"Software","normalized_amount":"0.1746","time_since_last":"2"},{"id":"17","name":"Health Care","normalized_amount":"0.163","time_since_last":"1"},{"id":"18","name":"Telecommunications","normalized_amount":"0.1467","time_since_last":"3"},{"id":"19","name":"Clean Technology","normalized_amount":"0.1455","time_since_last":"1"},{"id":"20","name":"Curated Web","normalized_amount":"0.1364","time_since_last":"2"},{"id":"21","name":"Hotels","normalized_amount":"0.1315","time_since_last":"4"},{"id":"22","name":"Security","normalized_amount":"0.1315","time_since_last":"2"},{"id":"23","name":"Design","normalized_amount":"0.1257","time_since_last":"2"},{"id":"24","name":"Manufacturing","normalized_amount":"0.1246","time_since_last":"2"},{"id":"25","name":"Music","normalized_amount":"0.1234","time_since_last":"2"},{"id":"26","name":"Automotive","normalized_amount":"0.1232","time_since_last":"2"},{"id":"27","name":"Hardware","normalized_amount":"0.1164","time_since_last":"4"},{"id":"28","name":"Oil & Gas","normalized_amount":"0.1164","time_since_last":"2"},{"id":"29","name":"Storage","normalized_amount":"0.1164","time_since_last":"4"},{"id":"30","name":"Travel","normalized_amount":"0.1106","time_since_last":"2"},{"id":"31","name":"Search","normalized_amount":"0.1043","time_since_last":"2"},{"id":"32","name":"Photography","normalized_amount":"0.0978","time_since_last":"3"},{"id":"33","name":"Enterprise Software","normalized_amount":"0.0955","time_since_last":"1"},{"id":"34","name":"Games","normalized_amount":"0.0931","time_since_last":"2"},{"id":"35","name":"Solar","normalized_amount":"0.0931","time_since_last":"4"},{"id":"36","name":"Fashion","normalized_amount":"0.0848","time_since_last":"2"},{"id":"37","name":"Home Automation","normalized_amount":"0.0848","time_since_last":"2"},{"id":"38","name":"Hospitality","normalized_amount":"0.0815","time_since_last":"2"},{"id":"39","name":"Publishing","normalized_amount":"0.0815","time_since_last":"2"},{"id":"40","name":"Biotechnology","normalized_amount":"0.0743","time_since_last":"1"},{"id":"41","name":"Web Tools","normalized_amount":"0.0722","time_since_last":"8"},{"id":"42","name":"Mobile","normalized_amount":"0.0698","time_since_last":"1"},{"id":"43","name":"Public Relations","normalized_amount":"0.0682","time_since_last":"2"},{"id":"44","name":"Construction","normalized_amount":"0.0652","time_since_last":"2"},{"id":"45","name":"Messaging","normalized_amount":"0.0652","time_since_last":"3"},{"id":"46","name":"Semiconductors","normalized_amount":"0.0605","time_since_last":"2"},{"id":"47","name":"Entertainment","normalized_amount":"0.0582","time_since_last":"2"},{"id":"48","name":"News","normalized_amount":"0.0582","time_since_last":"2"},{"id":"49","name":"Video Streaming","normalized_amount":"0.0582","time_since_last":"2"},{"id":"50","name":"Batteries","normalized_amount":"0.058","time_since_last":"4"},{"id":"51","name":"Hardware + Software","normalized_amount":"0.0554","time_since_last":"2"},{"id":"52","name":"Real Estate","normalized_amount":"0.0468","time_since_last":"2"},{"id":"53","name":"Big Data","normalized_amount":"0.0466","time_since_last":"2"},{"id":"54","name":"Mobile Payments","normalized_amount":"0.0466","time_since_last":"2"},{"id":"55","name":"Shoes","normalized_amount":"0.0466","time_since_last":"5"},{"id":"56","name":"Social Media","normalized_amount":"0.0466","time_since_last":"2"},{"id":"57","name":"Web Hosting","normalized_amount":"0.0466","time_since_last":"2"},{"id":"58","name":"Chemicals","normalized_amount":"0.0463","time_since_last":"6"},{"id":"59","name":"Web CMS","normalized_amount":"0.0373","time_since_last":"3"},{"id":"60","name":"Payments","normalized_amount":"0.0361","time_since_last":"2"},{"id":"61","name":"Cloud Computing","normalized_amount":"0.0349","time_since_last":"2"},{"id":"62","name":"Diabetes","normalized_amount":"0.0349","time_since_last":"3"},{"id":"63","name":"File Sharing","normalized_amount":"0.0349","time_since_last":"4"},{"id":"64","name":"Shopping","normalized_amount":"0.0321","time_since_last":"4"},{"id":"65","name":"Big Data Analytics","normalized_amount":"0.0319","time_since_last":"2"},{"id":"66","name":"Event Management","normalized_amount":"0.0317","time_since_last":"6"},{"id":"67","name":"Cloud Data Services","normalized_amount":"0.0314","time_since_last":"2"},{"id":"68","name":"Consumer Electronics","normalized_amount":"0.0314","time_since_last":"2"},{"id":"69","name":"Credit","normalized_amount":"0.0303","time_since_last":"2"},{"id":"70","name":"Recreation","normalized_amount":"0.03","time_since_last":"10"},{"id":"71","name":"Medical Professionals","normalized_amount":"0.0298","time_since_last":"1"},{"id":"72","name":"Web Development","normalized_amount":"0.0291","time_since_last":"3"},{"id":"73","name":"Retail","normalized_amount":"0.0279","time_since_last":"2"},{"id":"74","name":"Risk Management","normalized_amount":"0.0273","time_since_last":"3"},{"id":"75","name":"Home & Garden","normalized_amount":"0.0261","time_since_last":"2"},{"id":"76","name":"Oil","normalized_amount":"0.0256","time_since_last":"1"},{"id":"77","name":"Sports","normalized_amount":"0.0253","time_since_last":"2"},{"id":"78","name":"Smart Grid","normalized_amount":"0.0247","time_since_last":"4"},{"id":"79","name":"Bio-Pharm","normalized_amount":"0.0244","time_since_last":"7"},{"id":"80","name":"Cloud-Based Music","normalized_amount":"0.0242","time_since_last":"3"},{"id":"81","name":"Customer Service","normalized_amount":"0.024","time_since_last":"3"},{"id":"82","name":"Business Services","normalized_amount":"0.0233","time_since_last":"3"},{"id":"83","name":"Communications Hardware","normalized_amount":"0.0233","time_since_last":"1"},{"id":"84","name":"Consulting","normalized_amount":"0.0233","time_since_last":"2"},{"id":"85","name":"English-Speaking","normalized_amount":"0.0233","time_since_last":"10"},{"id":"86","name":"Lead Management","normalized_amount":"0.0233","time_since_last":"7"},{"id":"87","name":"Medical Devices","normalized_amount":"0.0233","time_since_last":"2"},{"id":"88","name":"Public Transportation","normalized_amount":"0.0233","time_since_last":"3"},{"id":"89","name":"SaaS","normalized_amount":"0.0233","time_since_last":"2"},{"id":"90","name":"Semantic Search","normalized_amount":"0.0233","time_since_last":"2"},{"id":"91","name":"Tablets","normalized_amount":"0.0233","time_since_last":"6"},{"id":"92","name":"Content Delivery","normalized_amount":"0.0225","time_since_last":"3"},{"id":"93","name":"Data Security","normalized_amount":"0.0221","time_since_last":"5"},{"id":"94","name":"Fleet Management","normalized_amount":"0.0217","time_since_last":"2"},{"id":"95","name":"Financial Services","normalized_amount":"0.0205","time_since_last":"2"},{"id":"96","name":"Email Marketing","normalized_amount":"0.0203","time_since_last":"2"},{"id":"97","name":"Opinions","normalized_amount":"0.0198","time_since_last":"7"},{"id":"98","name":"B2B Express Delivery","normalized_amount":"0.0186","time_since_last":"7"},{"id":"99","name":"Credit Cards","normalized_amount":"0.0186","time_since_last":"3"},{"id":"100","name":"Environmental Innovation","normalized_amount":"0.0186","time_since_last":"2"},{"id":"101","name":"Group Buying","normalized_amount":"0.0186","time_since_last":"6"},{"id":"102","name":"Insurance","normalized_amount":"0.0186","time_since_last":"4"},{"id":"103","name":"Peer-to-Peer","normalized_amount":"0.0186","time_since_last":"5"},{"id":"104","name":"Clean Energy","normalized_amount":"0.0177","time_since_last":"4"},{"id":"105","name":"Energy Efficiency","normalized_amount":"0.0175","time_since_last":"6"},{"id":"106","name":"Farming","normalized_amount":"0.0175","time_since_last":"2"},{"id":"107","name":"Financial Exchanges","normalized_amount":"0.0175","time_since_last":"3"},{"id":"108","name":"Virtualization","normalized_amount":"0.0175","time_since_last":"5"},{"id":"109","name":"Energy","normalized_amount":"0.0171","time_since_last":"2"},{"id":"110","name":"Aerospace","normalized_amount":"0.0163","time_since_last":"4"},{"id":"111","name":"Dental","normalized_amount":"0.0163","time_since_last":"7"},{"id":"112","name":"Fantasy Sports","normalized_amount":"0.0163","time_since_last":"3"},{"id":"113","name":"Marketing Automation","normalized_amount":"0.0163","time_since_last":"2"},{"id":"114","name":"Navigation","normalized_amount":"0.0163","time_since_last":"3"},{"id":"115","name":"Networking","normalized_amount":"0.0163","time_since_last":"2"},{"id":"116","name":"Personal Finance","normalized_amount":"0.0163","time_since_last":"3"},{"id":"117","name":"Human Resources","normalized_amount":"0.0155","time_since_last":"2"},{"id":"118","name":"Sales and Marketing","normalized_amount":"0.0144","time_since_last":"4"},{"id":"119","name":"Nanotechnology","normalized_amount":"0.0141","time_since_last":"2"},{"id":"120","name":"Data Integration","normalized_amount":"0.014","time_since_last":"2"},{"id":"121","name":"Enterprises","normalized_amount":"0.014","time_since_last":"2"},{"id":"122","name":"Hospitals","normalized_amount":"0.014","time_since_last":"6"},{"id":"123","name":"Marketplaces","normalized_amount":"0.014","time_since_last":"2"},{"id":"124","name":"Tech Field Support","normalized_amount":"0.014","time_since_last":"2"},{"id":"125","name":"Video","normalized_amount":"0.014","time_since_last":"2"},{"id":"126","name":"Discounts","normalized_amount":"0.0132","time_since_last":"3"},{"id":"127","name":"Data Centers","normalized_amount":"0.0128","time_since_last":"1"},{"id":"128","name":"Content","normalized_amount":"0.0126","time_since_last":"2"},{"id":"129","name":"Testing","normalized_amount":"0.0126","time_since_last":"3"},{"id":"130","name":"Geospatial","normalized_amount":"0.0121","time_since_last":"7"},{"id":"131","name":"Mobile Security","normalized_amount":"0.0121","time_since_last":"2"},{"id":"132","name":"Television","normalized_amount":"0.0119","time_since_last":"0"},{"id":"133","name":"Pharmaceuticals","normalized_amount":"0.0118","time_since_last":"2"},{"id":"134","name":"Agriculture","normalized_amount":"0.0116","time_since_last":"2"},{"id":"135","name":"Billing","normalized_amount":"0.0116","time_since_last":"6"},{"id":"136","name":"Enterprise Resource Planning","normalized_amount":"0.0116","time_since_last":"5"},{"id":"137","name":"Medical","normalized_amount":"0.0116","time_since_last":"3"},{"id":"138","name":"Optimization","normalized_amount":"0.0116","time_since_last":"5"},{"id":"139","name":"Therapeutics","normalized_amount":"0.0114","time_since_last":"10"},{"id":"140","name":"Fraud Detection","normalized_amount":"0.0105","time_since_last":"9"},{"id":"141","name":"Groceries","normalized_amount":"0.0102","time_since_last":"4"},{"id":"142","name":"Identity","normalized_amount":"0.0102","time_since_last":"2"},{"id":"143","name":"Databases","normalized_amount":"0.0098","time_since_last":"3"},{"id":"144","name":"Home Decor","normalized_amount":"0.0095","time_since_last":"2"},{"id":"145","name":"Data Center Infrastructure","normalized_amount":"0.0093","time_since_last":"8"},{"id":"146","name":"Doctors","normalized_amount":"0.0093","time_since_last":"7"},{"id":"147","name":"Information Security","normalized_amount":"0.0093","time_since_last":"4"},{"id":"148","name":"Wind","normalized_amount":"0.0091","time_since_last":"11"},{"id":"149","name":"Collaboration","normalized_amount":"0.0087","time_since_last":"2"},{"id":"150","name":"Apps","normalized_amount":"0.0084","time_since_last":"2"},{"id":"151","name":"Brokers","normalized_amount":"0.0081","time_since_last":"6"},{"id":"152","name":"Specialty Chemicals","normalized_amount":"0.008","time_since_last":"3"},{"id":"153","name":"Diagnostics","normalized_amount":"0.007","time_since_last":"7"},{"id":"154","name":"Distributed Generation","normalized_amount":"0.007","time_since_last":"9"},{"id":"155","name":"Game Mechanics","normalized_amount":"0.007","time_since_last":"8"},{"id":"156","name":"Religion","normalized_amount":"0.007","time_since_last":"7"},{"id":"157","name":"World Domination","normalized_amount":"0.0061","time_since_last":"1"},{"id":"158","name":"Coffee","normalized_amount":"0.006","time_since_last":"3"},{"id":"159","name":"Coworking","normalized_amount":"0.0047","time_since_last":"0"},{"id":"160","name":"Lingerie","normalized_amount":"0.0047","time_since_last":"5"},{"id":"161","name":"Rapidly Expanding","normalized_amount":"0.0047","time_since_last":"0"},{"id":"162","name":"Call Center Automation","normalized_amount":"0.0035","time_since_last":"6"},{"id":"163","name":"Recipes","normalized_amount":"0.0031","time_since_last":"0"}]';
              
           data = $.parseJSON(data);
           console.dir(data);

           var width = 2000,
               height = 1000,
               padding = 1.5, // separation between same-color circles
               clusterPadding = 10, // separation between different-color circles
               maxRadius = 300;
           
           var n = data.length, // total number of circles // data.length
               m = 10; // number of distinct clusters // data .length / some number 
           
           var color = d3.scale.category10()
               .domain(d3.range(m));

            var xClickScale = d3.scale.linear()
                .domain([0, width])
                .range([width-leftBound, width-rightBound]);

            var yClickScale = d3.scale.linear()
                .domain([0, height])
                .range([height - topBound, height - bottomBound]);
            
            var leftBound = 500,
                rightBound = 500,
                topBound = 500,
                bottomBound = 500;

           
           // The largest node for each cluster.
           var clusters = new Array(m);
           
           var nodes = d3.range(n).map(function(currentValue, index) {
           
             var i = Math.floor(Math.random() * m),
             // this sets the radius of the circles
                 r = Math.sqrt((i + 1) / m * -Math.log(Math.random())) * maxRadius,
                 d = {cluster: i, radius: data[index].normalized_amount * maxRadius, 
                               time_since_last: data[index].time_since_last, 
                               market_id: data[index].id};
           
             if (!clusters[i] || (r > clusters[i].radius)) clusters[i] = d;
             return d;
           });
           
           var force = d3.layout.force()
               .nodes(nodes)
               .size([width, height])
               .gravity(.25)
               .charge(-10000)
               .friction(0.1)
               .on("tick", tick)
               .start();
           
            d3.layout.pack()
                .sort(null)
                .size([width, height])
                .children(function(d) { return d.values; })
                .value(function(d) { return d.radius * d.radius; })
                .nodes({values: d3.nest()
                .key(function(d) { return d.cluster; })
                .entries(nodes)});

           var svg = d3.select("body").append("svg")
               .attr("width", width)
               .attr("height", height);
           
           var circle = svg.selectAll("circle")
               .data(nodes)
               .enter().append("circle")
               .attr("id", function(d) {return "circle_" + d.market_id;})
               .attr("r", function(d) { return d.radius; })
               .attr("class", function(d) { 
                     var c = "";
                     if (d.time_since_last < 2) {c = "default red"} 
                     else if (d.time_since_last >= 2 && d.time_since_last <= 6) {c = "default violet"}
                     else if (d.time_since_last > 6 && d.time_since_last <= 12) {c = "default mediumvioletred"}
                     else if (d.time_since_last > 12 && d.time_since_last <= 18) {c = "default blue"}
                     else if (d.time_since_last > 18 && d.time_since_last <= 24) {c = "default blueviolet"}
                     else if (d.time_since_last > 24) {c = "indigo"}
                     return c;
                   })
               // .attr("class, default")
               // .call(force.drag);
        $(document).ready(function() {

            var data = [{"id":"1","name":"Finance"},{"id":"2","name":"Internet"},{"id":"3","name":"Health and Wellness"},{"id":"4","name":"Communities"},{"id":"6","name":"Technology"},{"id":"8","name":"Content Creators"},{"id":"9","name":"E-Commerce"},{"id":"10","name":"Online Shopping"},{"id":"11","name":"Wireless"},{"id":"12","name":"Advertising"},{"id":"14","name":"Education"},{"id":"15","name":"Food Processing"},{"id":"16","name":"Software"},{"id":"17","name":"Health Care"},{"id":"18","name":"Telecommunications"},{"id":"19","name":"Clean Technology"},{"id":"20","name":"Curated Web"},{"id":"21","name":"Hotels"},{"id":"22","name":"Security"},{"id":"23","name":"Design"},{"id":"26","name":"Automotive"},{"id":"27","name":"Hardware"},{"id":"29","name":"Storage"},{"id":"30","name":"Travel"},{"id":"31","name":"Search"},{"id":"33","name":"Enterprise Software"},{"id":"34","name":"Games"},{"id":"37","name":"Home Automation"},{"id":"40","name":"Biotechnology"},{"id":"41","name":"Web Tools"},{"id":"42","name":"Mobile"},{"id":"43","name":"Public Relations"},{"id":"45","name":"Messaging"},{"id":"46","name":"Semiconductors"},{"id":"47","name":"Entertainment"},{"id":"48","name":"News"},{"id":"49","name":"Video Streaming"},{"id":"50","name":"Batteries"},{"id":"51","name":"Hardware + Software"},{"id":"52","name":"Real Estate"},{"id":"54","name":"Mobile Payments"},{"id":"55","name":"Shoes"},{"id":"56","name":"Social Media"},{"id":"57","name":"Web Hosting"},{"id":"58","name":"Chemicals"},{"id":"59","name":"Web CMS"},{"id":"60","name":"Payments"},{"id":"62","name":"Diabetes"},{"id":"63","name":"File Sharing"},{"id":"66","name":"Event Management"},{"id":"67","name":"Cloud Data Services"},{"id":"68","name":"Consumer Electronics"},{"id":"69","name":"Credit"},{"id":"70","name":"Recreation"},{"id":"71","name":"Medical Professionals"},{"id":"72","name":"Web Development"},{"id":"73","name":"Retail"},{"id":"74","name":"Risk Management"},{"id":"75","name":"Home & Garden"},{"id":"80","name":"Cloud-Based Music"},{"id":"81","name":"Customer Service"},{"id":"82","name":"Business Services"},{"id":"83","name":"Communications Hardware"},{"id":"85","name":"English-Speaking"},{"id":"86","name":"Lead Management"},{"id":"87","name":"Medical Devices"},{"id":"90","name":"Semantic Search"},{"id":"91","name":"Tablets"},{"id":"92","name":"Content Delivery"},{"id":"93","name":"Data Security"},{"id":"94","name":"Fleet Management"},{"id":"95","name":"Financial Services"},{"id":"96","name":"Email Marketing"},{"id":"98","name":"B2B Express Delivery"},{"id":"99","name":"Credit Cards"},{"id":"100","name":"Environmental Innovation"},{"id":"102","name":"Insurance"},{"id":"103","name":"Peer-to-Peer"},{"id":"104","name":"Clean Energy"},{"id":"105","name":"Energy Efficiency"},{"id":"107","name":"Financial Exchanges"},{"id":"109","name":"Energy"},{"id":"110","name":"Aerospace"},{"id":"111","name":"Dental"},{"id":"113","name":"Marketing Automation"},{"id":"115","name":"Networking"},{"id":"116","name":"Personal Finance"},{"id":"117","name":"Human Resources"},{"id":"118","name":"Sales and Marketing"},{"id":"119","name":"Nanotechnology"},{"id":"120","name":"Data Integration"},{"id":"121","name":"Enterprises"},{"id":"123","name":"Marketplaces"},{"id":"124","name":"Tech Field Support"},{"id":"125","name":"Video"},{"id":"127","name":"Data Centers"},{"id":"128","name":"Content"},{"id":"129","name":"Testing"},{"id":"130","name":"Geospatial"},{"id":"131","name":"Mobile Security"},{"id":"132","name":"Television"},{"id":"133","name":"Pharmaceuticals"},{"id":"134","name":"Agriculture"},{"id":"136","name":"Enterprise Resource Planning"},{"id":"137","name":"Medical"},{"id":"139","name":"Therapeutics"},{"id":"140","name":"Fraud Detection"},{"id":"141","name":"Groceries"},{"id":"142","name":"Identity"},{"id":"143","name":"Databases"},{"id":"144","name":"Home Decor"},{"id":"145","name":"Data Center Infrastructure"},{"id":"147","name":"Information Security"},{"id":"151","name":"Brokers"},{"id":"152","name":"Specialty Chemicals"},{"id":"154","name":"Distributed Generation"},{"id":"155","name":"Game Mechanics"},{"id":"156","name":"Religion"},{"id":"158","name":"Coffee"},{"id":"160","name":"Lingerie"},{"id":"161","name":"Rapidly Expanding"},{"id":"162","name":"Call Center Automation"},{"id":"163","name":"Recipes"}];

            $("#demo-input").tokenInput(data,
                {
                    theme: "mrktbeat",
                    preventDuplicates: true,
                    tokenValue: "name",
                    hintText: "Type a market name",
                    onAdd: removeCircleColorClass,
                    onDelete: addCircleColorClass
              });

        $(document).keypress(function(event) {
            if (event.which == 13 && $('[class^="token-input-token"]').length > 0) {
                $('form').submit();
            }
        });

           
            node.transition()
                .duration(750)
                .delay(function(d, i) { return i * 5; })
                .attrTween("r", function(d) {
                  var i = d3.interpolate(0, d.radius);
                  return function(t) { return d.radius = i(t); };
                });
           
           });

        function tick(e) {
             var circle = d3.selectAll("circle")
                 .each(cluster(5 * e.alpha * e.alpha))
                 .each(collide(.5))
                 .attr("cx", function(d) { return d.x; })
                 .attr("cy", function(d) { return d.y; });
           }
           
           // Move d to be adjacent to the cluster node.
           function cluster(alpha) {
             return function(d) {
               var cluster = clusters[d.cluster];
               if (cluster === d) return;
               var x = d.x - cluster.x,
                   y = d.y - cluster.y,
                   l = Math.sqrt(x * x + y * y),
                   r = d.radius + cluster.radius;
               if (l != r) {
                 l = (l - r) / l * alpha;
                 d.x -= x *= l;
                 d.y -= y *= l;
                 cluster.x += x;
                 cluster.y += y;
               }
             };
           }
           
           // Resolves collisions between d and all other circles.
           function collide(alpha) {
             var quadtree = d3.geom.quadtree(nodes);
             return function(d) {
               var r = d.radius + maxRadius + Math.max(padding, clusterPadding),
                   nx1 = d.x - r,
                   nx2 = d.x + r,
                   ny1 = d.y - r,
                   ny2 = d.y + r;
               quadtree.visit(function(quad, x1, y1, x2, y2) {
                 if (quad.point && (quad.point !== d)) {
                   var x = d.x - quad.point.x,
                       y = d.y - quad.point.y,
                       l = Math.sqrt(x * x + y * y),
                       r = d.radius + quad.point.radius + (d.cluster === quad.point.cluster ? padding : clusterPadding);
                   if (l < r) {
                     l = (l - r) / l * alpha;
                     d.x -= x *= l;
                     d.y -= y *= l;
                     quad.point.x += x;
                     quad.point.y += y;
                   }
                 }
                 return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
               });
             };
           }
           
           function removeCircleColorClass(token) {
              
               //  reset the x position to a point within a specified range
               //  reset the cy position to a point with a specified range 
               var x = Math.random() * xClickScale;
               var y = Math.random() * yClickScale;


               var circleSelect = d3.select("#circle_" + token.id)

               circleSelect.classed("default",false)

               circleSelect
                    .transition()
                    .duration(2000)
                    .ease("elastic")
                    .attr("r", function(d) {
                      return d.radius * 1.15;
                    })
                    .collide(.5);


                


           }
           
           function addCircleColorClass(token) {
               // var circleSelected = token.name;
               // if (circleSelected == d.market && circleSelected.classed("default", false)) {
               //   circleSelected.classed("default", true);
               // }
               d3.select("#circle_" + token.id).classed("default",true);
            
           }


    </script>
</body>
</html>